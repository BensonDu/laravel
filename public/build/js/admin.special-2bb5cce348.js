(function(){this.w=$(window),this.d=$(document),this.filter=$("#filter"),this.content=$("#admin-content"),this.mid=$("#mid")}).call(define("dom")),function(){window.view_nav_left.fold=function(){return dom.mid.css("left",60),dom.content.css("padding-left",310),dom.filter.addClass("trans").removeClass("unfold")},window.view_nav_left.unfold=function(){return dom.mid.css("left",140),dom.content.css("padding-left",390),dom.filter.addClass("trans").addClass("unfold")}}.call(define("view_page_response")),!function(){var t,e=[].slice;t=function(){function t(t){var e,i,n,a,o,r,s;if(this.opts=$.extend({},this.opts,t),(o=this.constructor)._connectedClasses||(o._connectedClasses=[]),n=function(){var t,i,n,o;for(n=this.constructor._connectedClasses,o=[],t=0,i=n.length;i>t;t++)e=n[t],a=e.pluginName.charAt(0).toLowerCase()+e.pluginName.slice(1),e.prototype._connected&&(e.prototype._module=this),o.push(this[a]=new e);return o}.call(this),this._connected)this.opts=$.extend({},this.opts,this._module.opts);else for(this._init(),r=0,s=n.length;s>r;r++)i=n[r],"function"==typeof i._init&&i._init();this.trigger("initialized")}return t.extend=function(t){var e,i,n;if(null!=t&&"object"==typeof t){for(e in t)i=t[e],"included"!==e&&"extended"!==e&&(this[e]=i);return null!=(n=t.extended)?n.call(this):void 0}},t.include=function(t){var e,i,n;if(null!=t&&"object"==typeof t){for(e in t)i=t[e],"included"!==e&&"extended"!==e&&(this.prototype[e]=i);return null!=(n=t.included)?n.call(this):void 0}},t.connect=function(t){if("function"==typeof t){if(!t.pluginName)throw new Error("Module.connect: cannot connect plugin without pluginName");return t.prototype._connected=!0,this._connectedClasses||(this._connectedClasses=[]),this._connectedClasses.push(t),t.pluginName?this[t.pluginName]=t:void 0}},t.prototype.opts={},t.prototype._init=function(){},t.prototype.on=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],(i=$(this)).on.apply(i,t),this},t.prototype.one=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],(i=$(this)).one.apply(i,t),this},t.prototype.off=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],(i=$(this)).off.apply(i,t),this},t.prototype.trigger=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],(i=$(this)).trigger.apply(i,t),this},t.prototype.triggerHandler=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],(i=$(this)).triggerHandler.apply(i,t)},t.prototype._t=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],(i=this.constructor)._t.apply(i,t)},t._t=function(){var t,i,n,a;return i=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],n=(null!=(a=this.i18n[this.locale])?a[i]:void 0)||"",t.length>0?(n=n.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(e,i,n){return n?i+t[parseInt(n)-1]:i+t.shift()}),n.replace(/%%s/g,"%s")):n},t.i18n={"zh-CN":{}},t.locale="zh-CN",t}(),window.SimpleModule=t}.call(this),!function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var a in e)i.call(e,a)&&(t[a]=e[a]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.count=0,e.prototype.opts={url:"",params:null,fileKey:"upload_file",connectionCount:3},e.prototype._init=function(){return this.files=[],this.queue=[],this.id=++e.count,this.on("uploadcomplete",function(t){return function(e,i){return t.files.splice($.inArray(i,t.files),1),t.queue.length>0&&t.files.length<t.opts.connectionCount?t.upload(t.queue.shift()):t.uploading=!1}}(this)),$(window).on("beforeunload.uploader-"+this.id,function(t){return function(e){return t.uploading?(e.originalEvent.returnValue=t._t("leaveConfirm"),t._t("leaveConfirm")):void 0}}(this))},e.prototype.generateId=function(){var t;return t=0,function(){return t+=1}}(),e.prototype.upload=function(t,e){var i,n,a,o;if(null==e&&(e={}),null!=t){if($.isArray(t)||t instanceof window.FileList)for(a=0,o=t.length;o>a;a++)i=t[a],this.upload(i,e);else $(t).is("input:file")?(n=$(t).attr("name"),n&&(e.fileKey=n),this.upload($.makeArray($(t)[0].files),e)):t.id&&t.obj||(t=this.getFile(t));if(t&&t.obj){if($.extend(t,e),this.files.length>=this.opts.connectionCount)return void this.queue.push(t);if(this.triggerHandler("beforeupload",[t])!==!1)return this.files.push(t),this._xhrUpload(t),this.uploading=!0}}},e.prototype.getFile=function(t){var e,i,n;return t instanceof window.File||t instanceof window.Blob?(e=null!=(i=t.fileName)?i:t.name,{id:this.generateId(),params:this.opts.params,fileKey:this.opts.fileKey,name:e,size:null!=(n=t.fileSize)?n:t.size,ext:e?e.split(".").pop().toLowerCase():"",obj:t}):null},e.prototype._xhrUpload=function(t){var e;return e=this,$.ajax({dataType:"json",url:"/qiniu/upload/token",async:!0,success:function(i){var n,a,o,r;if(n=new FormData,n.append("file",t.obj),n.append("key",function(t){var e=t.split("."),i=e.length,n=e[i-1],a=(new Date).getTime(),o=function(t){t=escape(t);var e,i,n,a,o,r="",s="",l="",c=0,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";do e=t.charCodeAt(c++),i=t.charCodeAt(c++),s=t.charCodeAt(c++),n=e>>2,a=(3&e)<<4|i>>4,o=(15&i)<<2|s>>6,l=63&s,isNaN(i)?o=l=64:isNaN(s)&&(l=64),r=r+d.charAt(n)+d.charAt(a)+d.charAt(o)+d.charAt(l),e=i=s="",n=a=o=l="";while(c<t.length);return r}(t+a);return o.substr(0,16)+"."+n}(t.name)),t.params){r=t.params;for(a in r)o=r[a],n.append(a,o)}return n.append("token",i.token),t.xhr=$.ajax({url:"http://up.qiniu.com",data:n,dataType:"json",processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(t.name)},xhr:function(){var t;return t=$.ajaxSettings.xhr(),t&&(t.upload.onprogress=function(t){return function(e){return t.progress(e)}}(this)),t},progress:function(){return function(i){return i.lengthComputable?e.trigger("uploadprogress",[t,i.loaded,i.total]):void 0}}(this),error:function(){return function(i,n){return e.trigger("uploaderror",[t,i,n])}}(this),success:function(){return function(i){return e.trigger("uploadprogress",[t,t.size,t.size]),e.trigger("uploadsuccess",[t,i])}}(this),complete:function(){return function(i){return e.trigger("uploadcomplete",[t,i.responseText])}}(this)})}})},e.prototype.cancel=function(t){var e,i,n,a;if(!t.id)for(a=this.files,i=0,n=a.length;n>i;i++)if(e=a[i],e.id===1*t){t=e;break}return this.trigger("uploadcancel",[t]),t.xhr&&t.xhr.abort(),t.xhr=null},e.prototype.readImageFile=function(t,e){var i,n;if($.isFunction(e))return n=new Image,n.onload=function(){return e(n)},n.onerror=function(){return e()},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(t.type)?(i=new FileReader,i.onload=function(t){return n.src=t.target.result},i.readAsDataURL(t)):e()},e.prototype.destroy=function(){var t,e,i,n;for(this.queue.length=0,n=this.files,e=0,i=n.length;i>e;e++)t=n[e],this.cancel(t);return $(window).off(".uploader-"+this.id),$(document).off(".uploader-"+this.id)},e.i18n={"zh-CN":{leaveConfirm:"文件正在上传,确认退出?"}},e.locale="zh-CN",e}(SimpleModule),e=function(e){return new t(e)},window.simple=window.simple||{},simple.uploader=e,window.get_crop=function(t){var e,i,n,a,o,r,s;return n=t,a=0,r=0,s=0,n&&(o=n.w,i=n.h,o>i?(a=i,r=(o-i)/2,s=0):(a=o,r=0,s=(i-o)/2)),e=""+a+"x"+a+"a"+r+"a"+s}}.call(this),function(){this.imageUploader=function(t,e,i,n){var a=null,o=n?n:alert,r=2097152,s={},l="http://qiniu.cdn-chuang.com/";return a=simple.uploader({}),a.on("beforeupload",function(e,i,n){t(e,i,n)}),a.on("uploadprogress",function(t,i,n,a){e(parseFloat((n/a*100).toFixed(0)))}),a.on("uploadsuccess",function(t,e,n){n.hasOwnProperty("key")?i(l+n.key,n.key):o("上传失败")}),a.on("uploaderror",function(t,e,i,n){o("服务器错误")}),s={upload:function(t){var e=0;return t&&t[0]&&t[0].size&&(e=t[0].size),e>r?o("上传文件过大"):(a.upload(t),s)},cancel:function(){return a.cancel(),s},maxSize:function(t){return r=1024*t*1024,s}}}}.call(this),!function(t){"use strict";"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t():"undefined"!=typeof Package?Sortable=t():window.Sortable=t()}(function(){"use strict";function t(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(t);this.el=t,this.options=e=v({},e),t[R]=this;var i={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(t.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",filter:null,animation:0,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1};for(var n in i)!(n in e)&&(e[n]=i[n]);j(e);for(var o in this)"_"===o.charAt(0)&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&I,a(t,"mousedown",this._onTapStart),a(t,"touchstart",this._onTapStart),this.nativeDraggable&&(a(t,"dragover",this),a(t,"dragenter",this)),q.push(this._onDragOver),e.store&&this.sort(e.store.get(this))}function e(t){_&&_.state!==t&&(s(_,"display",t?"none":""),!t&&_.state&&x.insertBefore(_,w),_.state=t)}function i(t,e,i){if(t){i=i||M,e=e.split(".");var n=e.shift().toUpperCase(),a=new RegExp("\\s("+e.join("|")+")(?=\\s)","g");do if(">*"===n&&t.parentNode===i||(""===n||t.nodeName.toUpperCase()==n)&&(!e.length||((" "+t.className+" ").match(a)||[]).length==e.length))return t;while(t!==i&&(t=t.parentNode))}return null}function n(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.preventDefault()}function a(t,e,i){t.addEventListener(e,i,!1)}function o(t,e,i){t.removeEventListener(e,i,!1)}function r(t,e,i){if(t)if(t.classList)t.classList[i?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(z," ").replace(" "+e+" "," ");t.className=(n+(i?" "+e:"")).replace(z," ")}}function s(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return M.defaultView&&M.defaultView.getComputedStyle?i=M.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];e in n||(e="-webkit-"+e),n[e]=i+("string"==typeof i?"":"px")}}function l(t,e,i){if(t){var n=t.getElementsByTagName(e),a=0,o=n.length;if(i)for(;o>a;a++)i(n[a],a);return n}return[]}function c(t,e,i,n,a,o,r){var s=M.createEvent("Event"),l=(t||e[R]).options,c="on"+i.charAt(0).toUpperCase()+i.substr(1);s.initEvent(i,!0,!0),s.to=e,s.from=a||e,s.item=n||e,s.clone=_,s.oldIndex=o,s.newIndex=r,e.dispatchEvent(s),l[c]&&l[c].call(t,s)}function d(t,e,i,n,a,o){var r,s,l=t[R],c=l.options.onMove;return r=M.createEvent("Event"),r.initEvent("move",!0,!0),r.to=e,r.from=t,r.dragged=i,r.draggedRect=n,r.related=a||e,r.relatedRect=o||e.getBoundingClientRect(),t.dispatchEvent(r),c&&(s=c.call(l,r)),s}function p(t){t.draggable=!1}function h(){$=!1}function u(t,e){var i=t.lastElementChild,n=i.getBoundingClientRect();return(e.clientY-(n.top+n.height)>5||e.clientX-(n.right+n.width)>5)&&i}function f(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,n=0;i--;)n+=e.charCodeAt(i);return n.toString(36)}function g(t){var e=0;if(!t||!t.parentNode)return-1;for(;t&&(t=t.previousElementSibling);)"TEMPLATE"!==t.nodeName.toUpperCase()&&e++;return e}function m(t,e){var i,n;return function(){void 0===i&&(i=arguments,n=this,setTimeout(function(){1===i.length?t.call(n,i[0]):t.apply(n,i),i=void 0},e))}}function v(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}var w,b,y,_,x,D,C,T,k,B,E,L,N,S,X,Y,A,O={},z=/\s+/g,R="Sortable"+(new Date).getTime(),H=window,M=H.document,W=H.parseInt,I=!!("draggable"in M.createElement("div")),U=function(t){return t=M.createElement("x"),t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}(),$=!1,P=Math.abs,q=([].slice,[]),F=m(function(t,e,i){if(i&&e.scroll){var n,a,o,r,s=e.scrollSensitivity,l=e.scrollSpeed,c=t.clientX,d=t.clientY,p=window.innerWidth,h=window.innerHeight;if(T!==i&&(C=e.scroll,T=i,C===!0)){C=i;do if(C.offsetWidth<C.scrollWidth||C.offsetHeight<C.scrollHeight)break;while(C=C.parentNode)}C&&(n=C,a=C.getBoundingClientRect(),o=(P(a.right-c)<=s)-(P(a.left-c)<=s),r=(P(a.bottom-d)<=s)-(P(a.top-d)<=s)),o||r||(o=(s>=p-c)-(s>=c),r=(s>=h-d)-(s>=d),(o||r)&&(n=H)),(O.vx!==o||O.vy!==r||O.el!==n)&&(O.el=n,O.vx=o,O.vy=r,clearInterval(O.pid),n&&(O.pid=setInterval(function(){n===H?H.scrollTo(H.pageXOffset+o*l,H.pageYOffset+r*l):(r&&(n.scrollTop+=r*l),o&&(n.scrollLeft+=o*l))},24)))}},30),j=function(t){var e=t.group;e&&"object"==typeof e||(e=t.group={name:e}),["pull","put"].forEach(function(t){t in e||(e[t]=!0)}),t.groups=" "+e.name+(e.put.join?" "+e.put.join(" "):"")+" "};return t.prototype={constructor:t,_onTapStart:function(t){var e=this,n=this.el,a=this.options,o=t.type,r=t.touches&&t.touches[0],s=(r||t).target,l=s,d=a.filter;if(!("mousedown"===o&&0!==t.button||a.disabled)&&(s=i(s,a.draggable,n))){if(L=g(s),"function"==typeof d){if(d.call(this,t,s,this))return c(e,l,"filter",s,n,L),void t.preventDefault()}else if(d&&(d=d.split(",").some(function(t){return t=i(l,t.trim(),n),t?(c(e,t,"filter",s,n,L),!0):void 0})))return void t.preventDefault();(!a.handle||i(l,a.handle,n))&&this._prepareDragStart(t,r,s)}},_prepareDragStart:function(t,e,i){var n,o=this,s=o.el,c=o.options,d=s.ownerDocument;i&&!w&&i.parentNode===s&&(X=t,x=s,w=i,b=w.parentNode,D=w.nextSibling,S=c.group,n=function(){o._disableDelayedDrag(),w.draggable=!0,r(w,o.options.chosenClass,!0),o._triggerDragStart(e)},c.ignore.split(",").forEach(function(t){l(w,t.trim(),p)}),a(d,"mouseup",o._onDrop),a(d,"touchend",o._onDrop),a(d,"touchcancel",o._onDrop),c.delay?(a(d,"mouseup",o._disableDelayedDrag),a(d,"touchend",o._disableDelayedDrag),a(d,"touchcancel",o._disableDelayedDrag),a(d,"mousemove",o._disableDelayedDrag),a(d,"touchmove",o._disableDelayedDrag),o._dragStartTimer=setTimeout(n,c.delay)):n())},_disableDelayedDrag:function(){var t=this.el.ownerDocument;clearTimeout(this._dragStartTimer),o(t,"mouseup",this._disableDelayedDrag),o(t,"touchend",this._disableDelayedDrag),o(t,"touchcancel",this._disableDelayedDrag),o(t,"mousemove",this._disableDelayedDrag),o(t,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(t){t?(X={target:w,clientX:t.clientX,clientY:t.clientY},this._onDragStart(X,"touch")):this.nativeDraggable?(a(w,"dragend",this),a(x,"dragstart",this._onDragStart)):this._onDragStart(X,!0);try{M.selection?M.selection.empty():window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(){x&&w&&(r(w,this.options.ghostClass,!0),t.active=this,c(this,x,"start",w,x,L))},_emulateDragOver:function(){if(Y){if(this._lastX===Y.clientX&&this._lastY===Y.clientY)return;this._lastX=Y.clientX,this._lastY=Y.clientY,U||s(y,"display","none");var t=M.elementFromPoint(Y.clientX,Y.clientY),e=t,i=" "+this.options.group.name,n=q.length;if(e)do{if(e[R]&&e[R].options.groups.indexOf(i)>-1){for(;n--;)q[n]({clientX:Y.clientX,clientY:Y.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);U||s(y,"display","")}},_onTouchMove:function(e){if(X){t.active||this._dragStarted(),this._appendGhost();var i=e.touches?e.touches[0]:e,n=i.clientX-X.clientX,a=i.clientY-X.clientY,o=e.touches?"translate3d("+n+"px,"+a+"px,0)":"translate("+n+"px,"+a+"px)";A=!0,Y=i,s(y,"webkitTransform",o),s(y,"mozTransform",o),s(y,"msTransform",o),s(y,"transform",o),e.preventDefault()}},_appendGhost:function(){if(!y){var t,e=w.getBoundingClientRect(),i=s(w),n=this.options;y=w.cloneNode(!0),r(y,n.ghostClass,!1),r(y,n.fallbackClass,!0),s(y,"top",e.top-W(i.marginTop,10)),s(y,"left",e.left-W(i.marginLeft,10)),s(y,"width",e.width),s(y,"height",e.height),s(y,"opacity","0.8"),s(y,"position","fixed"),s(y,"zIndex","100000"),s(y,"pointerEvents","none"),n.fallbackOnBody&&M.body.appendChild(y)||x.appendChild(y),t=y.getBoundingClientRect(),s(y,"width",2*e.width-t.width),s(y,"height",2*e.height-t.height)}},_onDragStart:function(t,e){var i=t.dataTransfer,n=this.options;this._offUpEvents(),"clone"==S.pull&&(_=w.cloneNode(!0),s(_,"display","none"),x.insertBefore(_,w)),e?("touch"===e?(a(M,"touchmove",this._onTouchMove),a(M,"touchend",this._onDrop),a(M,"touchcancel",this._onDrop)):(a(M,"mousemove",this._onTouchMove),a(M,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(i&&(i.effectAllowed="move",n.setData&&n.setData.call(this,i,w)),a(M,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(t){var n,a,o,r=this.el,l=this.options,c=l.group,p=c.put,f=S===c,g=l.sort;if(void 0!==t.preventDefault&&(t.preventDefault(),!l.dragoverBubble&&t.stopPropagation()),A=!0,S&&!l.disabled&&(f?g||(o=!x.contains(w)):S.pull&&p&&(S.name===c.name||p.indexOf&&~p.indexOf(S.name)))&&(void 0===t.rootEl||t.rootEl===this.el)){if(F(t,l,this.el),$)return;if(n=i(t.target,l.draggable,r),a=w.getBoundingClientRect(),o)return e(!0),void(_||D?x.insertBefore(w,_||D):g||x.appendChild(w));if(0===r.children.length||r.children[0]===y||r===t.target&&(n=u(r,t))){if(n){if(n.animated)return;v=n.getBoundingClientRect()}e(f),d(x,r,w,a,n,v)!==!1&&(w.contains(r)||(r.appendChild(w),b=r),this._animate(a,w),n&&this._animate(v,n))}else if(n&&!n.animated&&n!==w&&void 0!==n.parentNode[R]){k!==n&&(k=n,B=s(n),E=s(n.parentNode));var m,v=n.getBoundingClientRect(),C=v.right-v.left,T=v.bottom-v.top,L=/left|right|inline/.test(B.cssFloat+B.display)||"flex"==E.display&&0===E["flex-direction"].indexOf("row"),N=n.offsetWidth>w.offsetWidth,X=n.offsetHeight>w.offsetHeight,Y=(L?(t.clientX-v.left)/C:(t.clientY-v.top)/T)>.5,O=n.nextElementSibling,z=d(x,r,w,a,n,v);if(z!==!1){if($=!0,setTimeout(h,30),e(f),1===z||-1===z)m=1===z;else if(L){var H=w.offsetTop,M=n.offsetTop;m=H===M?n.previousElementSibling===w&&!N||Y&&N:M>H}else m=O!==w&&!X||Y&&X;w.contains(r)||(m&&!O?r.appendChild(w):n.parentNode.insertBefore(w,m?O:n)),b=w.parentNode,this._animate(a,w),this._animate(v,n)}}}},_animate:function(t,e){var i=this.options.animation;if(i){var n=e.getBoundingClientRect();s(e,"transition","none"),s(e,"transform","translate3d("+(t.left-n.left)+"px,"+(t.top-n.top)+"px,0)"),e.offsetWidth,s(e,"transition","all "+i+"ms"),s(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=setTimeout(function(){s(e,"transition",""),s(e,"transform",""),e.animated=!1},i)}},_offUpEvents:function(){var t=this.el.ownerDocument;o(M,"touchmove",this._onTouchMove),o(t,"mouseup",this._onDrop),o(t,"touchend",this._onDrop),o(t,"touchcancel",this._onDrop)},_onDrop:function(e){var i=this.el,n=this.options;clearInterval(this._loopId),clearInterval(O.pid),clearTimeout(this._dragStartTimer),o(M,"mousemove",this._onTouchMove),this.nativeDraggable&&(o(M,"drop",this),o(i,"dragstart",this._onDragStart)),this._offUpEvents(),e&&(A&&(e.preventDefault(),!n.dropBubble&&e.stopPropagation()),y&&y.parentNode.removeChild(y),w&&(this.nativeDraggable&&o(w,"dragend",this),p(w),r(w,this.options.ghostClass,!1),r(w,this.options.chosenClass,!1),x!==b?(N=g(w),N>=0&&(c(null,b,"sort",w,x,L,N),c(this,x,"sort",w,x,L,N),c(null,b,"add",w,x,L,N),c(this,x,"remove",w,x,L,N))):(_&&_.parentNode.removeChild(_),w.nextSibling!==D&&(N=g(w),N>=0&&(c(this,x,"update",w,x,L,N),c(this,x,"sort",w,x,L,N)))),t.active&&((null===N||-1===N)&&(N=L),c(this,x,"end",w,x,L,N),this.save())),x=w=b=y=D=_=C=T=X=Y=A=N=k=B=S=t.active=null)},handleEvent:function(t){var e=t.type;"dragover"===e||"dragenter"===e?w&&(this._onDragOver(t),n(t)):("drop"===e||"dragend"===e)&&this._onDrop(t)},toArray:function(){for(var t,e=[],n=this.el.children,a=0,o=n.length,r=this.options;o>a;a++)t=n[a],i(t,r.draggable,this.el)&&e.push(t.getAttribute(r.dataIdAttr)||f(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach(function(t,a){var o=n.children[a];i(o,this.options.draggable,n)&&(e[t]=o)},this),t.forEach(function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return i(t,e||this.options.draggable,this.el)},option:function(t,e){var i=this.options;return void 0===e?i[t]:(i[t]=e,void("group"===t&&j(i)))},destroy:function(){var t=this.el;t[R]=null,o(t,"mousedown",this._onTapStart),o(t,"touchstart",this._onTapStart),this.nativeDraggable&&(o(t,"dragover",this),o(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),q.splice(q.indexOf(this._onDragOver),1),this._onDrop(),this.el=t=null}},t.utils={on:a,off:o,css:s,find:l,is:function(t,e){return!!i(t,e,t)},extend:v,throttle:m,closest:i,toggleClass:r,index:g},t.create=function(e,i){return new t(e,i)},t.version="1.4.2",t}),function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("Cropper requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function i(t){return re.call(t).slice(8,-1).toLowerCase()}function n(t){return"number"==typeof t&&!isNaN(t)}function a(t){return"undefined"==typeof t}function o(t){return"object"==typeof t&&null!==t}function r(t){var e,i;if(!o(t))return!1;try{return e=t.constructor,i=e.prototype,e&&i&&se.call(i,"isPrototypeOf")}catch(n){return!1}}function s(t){return"function"===i(t)}function l(t){return Z.isArray?Z.isArray(t):"array"===i(t)}function c(t,e){return e=e>=0?e:0,Z.from?Z.from(t).slice(e):le.call(t,e)}function d(t){return"string"==typeof t&&(t=t.trim?t.trim():t.replace(Et,"$1")),t}function p(t,e){var i,a;if(t&&s(e))if(l(t)||n(t.length))for(a=0,i=t.length;a<i&&e.call(t,t[a],a,t)!==!1;a++);else if(o(t))for(a in t)if(t.hasOwnProperty(a)&&e.call(t,t[a],a,t)===!1)break;return t}function h(t){var e;if(arguments.length>1){if(e=c(arguments),G.assign)return G.assign.apply(G,e);e.shift(),p(e,function(e){p(e,function(e,i){t[i]=e})})}return t}function u(t,e){var i=c(arguments,2);return function(){return t.apply(e,i.concat(c(arguments)))}}function f(t,e){var i=t.style;p(e,function(t,e){kt.test(e)&&n(t)&&(t+="px"),i[e]=t})}function g(t,e){return t.classList?t.classList.contains(e):t.className.indexOf(e)>-1}function m(t,e){var i;return n(t.length)?p(t,function(t){m(t,e)}):t.classList?t.classList.add(e):(i=d(t.className),void(i?i.indexOf(e)<0&&(t.className=i+" "+e):t.className=e))}function v(t,e){return n(t.length)?p(t,function(t){v(t,e)}):t.classList?t.classList.remove(e):void(t.className.indexOf(e)>=0&&(t.className=t.className.replace(e,"")))}function w(t,e,i){return n(t.length)?p(t,function(t){w(t,e,i)}):void(i?m(t,e):v(t,e))}function b(t,e){return o(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute("data-"+e)}function y(t,e,i){o(i)&&a(t[e])?t[e]=i:t.dataset?t.dataset[e]=i:t.setAttribute("data-"+e,i)}function _(t,e){o(t[e])?delete t[e]:t.dataset?delete t.dataset[e]:t.removeAttribute("data-"+e)}function x(t,e,i,n){var a=d(e).split(Lt),o=i;return a.length>1?p(a,function(e){x(t,e,i)}):(n&&(i=function(){return D(t,e,i),o.apply(t,arguments)}),void(t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i)))}function D(t,e,i){var n=d(e).split(Lt);return n.length>1?p(n,function(e){D(t,e,i)}):void(t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent&&t.detachEvent("on"+e,i))}function C(t,e,i){var n;return t.dispatchEvent?(s(Event)&&s(CustomEvent)?n=a(i)?new Event(e,{bubbles:!0,cancelable:!0}):new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0}):a(i)?(n=F.createEvent("Event"),n.initEvent(e,!0,!0)):(n=F.createEvent("CustomEvent"),n.initCustomEvent(e,!0,!0,i)),t.dispatchEvent(n)):t.fireEvent?t.fireEvent("on"+e):void 0}function T(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function k(e){var i,a=e||t.event;return a.target||(a.target=a.srcElement||F),n(a.pageX)||(i=F.documentElement,a.pageX=a.clientX+(t.scrollX||i&&i.scrollLeft||0)-(i&&i.clientLeft||0),a.pageY=a.clientY+(t.scrollY||i&&i.scrollTop||0)-(i&&i.clientTop||0)),a}function B(e){var i=F.documentElement,n=e.getBoundingClientRect();return{left:n.left+(t.scrollX||i&&i.scrollLeft||0)-(i&&i.clientLeft||0),top:n.top+(t.scrollY||i&&i.scrollTop||0)-(i&&i.clientTop||0)}}function E(t){var e=t.length,i=0,n=0;return e&&(p(t,function(t){i+=t.pageX,n+=t.pageY}),i/=e,n/=e),{pageX:i,pageY:n}}function L(t,e){return t.getElementsByTagName(e)}function N(t,e){return t.getElementsByClassName?t.getElementsByClassName(e):t.querySelectorAll("."+e)}function S(t){return F.createElement(t)}function X(t,e){t.appendChild(e)}function Y(t){t.parentNode&&t.parentNode.removeChild(t)}function A(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function O(t){var e=t.match(Bt);return e&&(e[1]!==j.protocol||e[2]!==j.hostname||e[3]!==j.port)}function z(t){var e="timestamp="+(new Date).getTime();return t+(t.indexOf("?")===-1?"?":"&")+e}function R(t,e){var i;return t.naturalWidth&&!Kt?e(t.naturalWidth,t.naturalHeight):(i=S("img"),i.onload=function(){e(this.width,this.height)},void(i.src=t.src))}function H(t){var e=[],i=t.rotate,a=t.scaleX,o=t.scaleY;return n(i)&&e.push("rotate("+i+"deg)"),n(a)&&n(o)&&e.push("scale("+a+","+o+")"),e.length?e.join(" "):"none"}function M(t,e){var i,n,a=Jt(t.degree)%180,o=(a>90?180-a:a)*ae/180,r=Qt(o),s=te(o),l=t.width,c=t.height,d=t.aspectRatio;return e?(i=l/(s+r/d),n=i/d):(i=l*s+c*r,n=l*r+c*s),{width:i,height:n}}function W(t,e){var i,a,o,r=S("canvas"),s=r.getContext("2d"),l=0,c=0,d=e.naturalWidth,p=e.naturalHeight,h=e.rotate,u=e.scaleX,f=e.scaleY,g=n(u)&&n(f)&&(1!==u||1!==f),m=n(h)&&0!==h,v=m||g,w=d*Jt(u||1),b=p*Jt(f||1);return g&&(i=w/2,a=b/2),m&&(o=M({width:w,height:b,degree:h}),w=o.width,b=o.height,i=w/2,a=b/2),r.width=w,r.height=b,v&&(l=-d/2,c=-p/2,s.save(),s.translate(i,a)),m&&s.rotate(h*ae/180),g&&s.scale(u,f),s.drawImage(t,ne(l),ne(c),ne(d),ne(p)),v&&s.restore(),r}function I(t,e,i){var n="",a=e;for(i+=e;a<i;a++)n+=ce(t.getUint8(a));return n}function U(t){var e,i,n,a,o,r,s,l,c,d,p=new DataView(t),h=p.byteLength;if(255===p.getUint8(0)&&216===p.getUint8(1))for(c=2;c<h;){if(255===p.getUint8(c)&&225===p.getUint8(c+1)){s=c;break}c++}if(s&&(i=s+4,n=s+10,"Exif"===I(p,i,4)&&(r=p.getUint16(n),o=18761===r,(o||19789===r)&&42===p.getUint16(n+2,o)&&(a=p.getUint32(n+4,o),a>=8&&(l=n+a)))),l)for(h=p.getUint16(l,o),d=0;d<h;d++)if(c=l+12*d+2,274===p.getUint16(c,o)){c+=8,e=p.getUint16(c,o),Kt&&p.setUint16(c,1,o);break}return e}function $(t){var e,i=t.replace(St,""),n=atob(i),a=n.length,o=new K(a),r=new Uint8Array(o);for(e=0;e<a;e++)r[e]=n.charCodeAt(e);return o}function P(t){var e,i=new Uint8Array(t),n=i.length,a="";for(e=0;e<n;e++)a+=ce(i[e]);return"data:image/jpeg;base64,"+btoa(a)}function q(t,e){var i=this;i.element=t,i.options=h({},q.DEFAULTS,r(e)&&e),i.ready=!1,i.built=!1,i.complete=!1,i.rotated=!1,i.cropped=!1,i.disabled=!1,i.replaced=!1,i.limited=!1,i.wheeling=!1,i.isImg=!1,i.originalUrl="",i.canvasData=null,i.cropBoxData=null,i.previews=null,i.init()}var F=t.document,j=t.location,V=t.navigator,K=t.ArrayBuffer,G=t.Object,Z=t.Array,J=t.String,Q=t.Number,tt=t.Math,et="cropper",it=et+"-modal",nt=et+"-hide",at=et+"-hidden",ot=et+"-invisible",rt=et+"-move",st=et+"-crop",lt=et+"-disabled",ct=et+"-bg",dt="mousedown touchstart pointerdown MSPointerDown",pt="mousemove touchmove pointermove MSPointerMove",ht="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",ut="wheel mousewheel DOMMouseScroll",ft="dblclick",gt="resize",mt="error",vt="load",wt="build",bt="built",yt="cropstart",_t="cropmove",xt="cropend",Dt="crop",Ct="zoom",Tt=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,kt=/width|height|left|top|marginLeft|marginTop/,Bt=/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i,Et=/^\s+(.*)\s+$/,Lt=/\s+/,Nt=/^data\:/,St=/^data\:([^\;]+)\;base64,/,Xt=/^data\:image\/jpeg.*;base64,/,Yt="preview",At="action",Ot="e",zt="w",Rt="s",Ht="n",Mt="se",Wt="sw",It="ne",Ut="nw",$t="all",Pt="crop",qt="move",Ft="zoom",jt="none",Vt=!!F.createElement("canvas").getContext,Kt=V&&/safari/i.test(V.userAgent)&&/apple computer/i.test(V.vendor),Gt=tt.min,Zt=tt.max,Jt=tt.abs,Qt=tt.sin,te=tt.cos,ee=tt.sqrt,ie=tt.round,ne=tt.floor,ae=tt.PI,oe=G.prototype,re=oe.toString,se=oe.hasOwnProperty,le=Z.prototype.slice,ce=J.fromCharCode;q.prototype={constructor:q,init:function(){var t,e=this,i=e.element,n=i.tagName.toLowerCase();if(!b(i,et)){if(y(i,et,e),"img"===n){if(e.isImg=!0,e.originalUrl=t=i.getAttribute("src"),!t)return;t=i.src}else"canvas"===n&&Vt&&(t=i.toDataURL());e.load(t)}},load:function(t){var e,i=this,n=i.options,a=i.element;if(t&&(s(n.build)&&x(a,wt,n.build,!0),C(a,wt)!==!1)){if(i.url=t,i.imageData={},!n.checkOrientation||!K)return i.clone();if(Nt.test(t))return Xt.test(t)?i.read($(t)):i.clone();e=new XMLHttpRequest,e.onerror=e.onabort=function(){i.clone()},e.onload=function(){i.read(this.response)},e.open("get",t),e.responseType="arraybuffer",e.send()}},read:function(t){var e,i,n,a=this,o=a.options,r=U(t),s=a.imageData;if(r>1)switch(a.url=P(t),r){case 2:i=-1;break;case 3:e=-180;break;case 4:n=-1;break;case 5:e=90,n=-1;break;case 6:e=90;break;case 7:e=90,i=-1;break;case 8:e=-90}o.rotatable&&(s.rotate=e),o.scalable&&(s.scaleX=i,s.scaleY=n),a.clone()},clone:function(){var t,e,i,n,a,o=this,r=o.element,s=o.url;o.options.checkCrossOrigin&&O(s)&&(t=r.crossOrigin,t?e=s:(t="anonymous",e=z(s))),o.crossOrigin=t,o.crossOriginUrl=e,i=S("img"),t&&(i.crossOrigin=t),i.src=e||s,o.image=i,o._start=n=u(o.start,o),o._stop=a=u(o.stop,o),o.isImg?r.complete?o.start():x(r,vt,n):(x(i,vt,n),x(i,mt,a),m(i,nt),r.parentNode.insertBefore(i,r.nextSibling))},start:function(t){var e=this,i=e.isImg?e.element:e.image;t&&(D(i,vt,e._start),D(i,mt,e._stop)),R(i,function(t,i){h(e.imageData,{naturalWidth:t,naturalHeight:i,aspectRatio:t/i}),e.ready=!0,e.build()})},stop:function(){var t=this,e=t.image;D(e,vt,t._start),D(e,mt,t._stop),Y(e),t.image=null},build:function(){var t,e,i,n,a,o,r,l=this,c=l.options,d=l.element,p=l.image;l.ready&&(l.built&&l.unbuild(),e=S("div"),e.innerHTML=q.TEMPLATE,l.container=t=d.parentNode,l.cropper=i=N(e,"cropper-container")[0],l.canvas=n=N(i,"cropper-canvas")[0],l.dragBox=a=N(i,"cropper-drag-box")[0],l.cropBox=o=N(i,"cropper-crop-box")[0],l.viewBox=N(i,"cropper-view-box")[0],l.face=r=N(o,"cropper-face")[0],X(n,p),m(d,at),t.insertBefore(i,d.nextSibling),l.isImg||v(p,nt),l.initPreview(),l.bind(),c.aspectRatio=Zt(0,c.aspectRatio)||NaN,c.viewMode=Zt(0,Gt(3,ie(c.viewMode)))||0,c.autoCrop?(l.cropped=!0,c.modal&&m(a,it)):m(o,at),c.guides||m(N(o,"cropper-dashed"),at),c.center||m(N(o,"cropper-center"),at),c.background&&m(i,ct),c.highlight||m(r,ot),c.cropBoxMovable&&(m(r,rt),y(r,At,$t)),c.cropBoxResizable||(m(N(o,"cropper-line"),at),m(N(o,"cropper-point"),at)),l.setDragMode(c.dragMode),l.render(),l.built=!0,l.setData(c.data),setTimeout(function(){s(c.built)&&x(d,bt,c.built,!0),C(d,bt),C(d,Dt,l.getData()),l.complete=!0},0))},unbuild:function(){var t=this;t.built&&(t.built=!1,t.complete=!1,t.initialImageData=null,t.initialCanvasData=null,t.initialCropBoxData=null,t.containerData=null,t.canvasData=null,t.cropBoxData=null,t.unbind(),t.resetPreview(),t.previews=null,t.viewBox=null,t.cropBox=null,t.dragBox=null,t.canvas=null,t.container=null,Y(t.cropper),t.cropper=null)},render:function(){var t=this;t.initContainer(),t.initCanvas(),t.initCropBox(),t.renderCanvas(),t.cropped&&t.renderCropBox()},initContainer:function(){var t,e=this,i=e.options,n=e.element,a=e.container,o=e.cropper;m(o,at),v(n,at),e.containerData=t={width:Zt(a.offsetWidth,Q(i.minContainerWidth)||200),height:Zt(a.offsetHeight,Q(i.minContainerHeight)||100)},f(o,{width:t.width,height:t.height}),m(n,at),v(o,at)},initCanvas:function(){var t,e=this,i=e.options.viewMode,n=e.containerData,a=e.imageData,o=90===Jt(a.rotate),r=o?a.naturalHeight:a.naturalWidth,s=o?a.naturalWidth:a.naturalHeight,l=r/s,c=n.width,d=n.height;n.height*l>n.width?3===i?c=n.height*l:d=n.width/l:3===i?d=n.width/l:c=n.height*l,t={naturalWidth:r,naturalHeight:s,aspectRatio:l,width:c,height:d},t.oldLeft=t.left=(n.width-c)/2,t.oldTop=t.top=(n.height-d)/2,e.canvasData=t,e.limited=1===i||2===i,e.limitCanvas(!0,!0),e.initialImageData=h({},a),e.initialCanvasData=h({},t)},limitCanvas:function(t,e){var i,n,a,o,r=this,s=r.options,l=s.viewMode,c=r.containerData,d=r.canvasData,p=d.aspectRatio,h=r.cropBoxData,u=r.cropped&&h;
t&&(i=Q(s.minCanvasWidth)||0,n=Q(s.minCanvasHeight)||0,l>1?(i=Zt(i,c.width),n=Zt(n,c.height),3===l&&(n*p>i?i=n*p:n=i/p)):l>0&&(i?i=Zt(i,u?h.width:0):n?n=Zt(n,u?h.height:0):u&&(i=h.width,n=h.height,n*p>i?i=n*p:n=i/p)),i&&n?n*p>i?n=i/p:i=n*p:i?n=i/p:n&&(i=n*p),d.minWidth=i,d.minHeight=n,d.maxWidth=1/0,d.maxHeight=1/0),e&&(l?(a=c.width-d.width,o=c.height-d.height,d.minLeft=Gt(0,a),d.minTop=Gt(0,o),d.maxLeft=Zt(0,a),d.maxTop=Zt(0,o),u&&r.limited&&(d.minLeft=Gt(h.left,h.left+h.width-d.width),d.minTop=Gt(h.top,h.top+h.height-d.height),d.maxLeft=h.left,d.maxTop=h.top,2===l&&(d.width>=c.width&&(d.minLeft=Gt(0,a),d.maxLeft=Zt(0,a)),d.height>=c.height&&(d.minTop=Gt(0,o),d.maxTop=Zt(0,o))))):(d.minLeft=-d.width,d.minTop=-d.height,d.maxLeft=c.width,d.maxTop=c.height))},renderCanvas:function(t){var e,i,n=this,a=n.canvasData,o=n.imageData,r=o.rotate;n.rotated&&(n.rotated=!1,i=M({width:o.width,height:o.height,degree:r}),e=i.width/i.height,e!==a.aspectRatio&&(a.left-=(i.width-a.width)/2,a.top-=(i.height-a.height)/2,a.width=i.width,a.height=i.height,a.aspectRatio=e,a.naturalWidth=o.naturalWidth,a.naturalHeight=o.naturalHeight,r%180&&(i=M({width:o.naturalWidth,height:o.naturalHeight,degree:r}),a.naturalWidth=i.width,a.naturalHeight=i.height),n.limitCanvas(!0,!1))),(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Gt(Zt(a.width,a.minWidth),a.maxWidth),a.height=Gt(Zt(a.height,a.minHeight),a.maxHeight),n.limitCanvas(!1,!0),a.oldLeft=a.left=Gt(Zt(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=Gt(Zt(a.top,a.minTop),a.maxTop),f(n.canvas,{width:a.width,height:a.height,left:a.left,top:a.top}),n.renderImage(),n.cropped&&n.limited&&n.limitCropBox(!0,!0),t&&n.output()},renderImage:function(t){var e,i,n,a,o,r=this,s=r.canvasData,l=r.imageData;l.rotate&&(i=M({width:s.width,height:s.height,degree:l.rotate,aspectRatio:l.aspectRatio},!0),n=i.width,a=i.height,e={width:n,height:a,left:(s.width-n)/2,top:(s.height-a)/2}),h(l,e||{width:s.width,height:s.height,left:0,top:0}),o=H(l),f(r.image,{width:l.width,height:l.height,marginLeft:l.left,marginTop:l.top,WebkitTransform:o,msTransform:o,transform:o}),t&&r.output()},initCropBox:function(){var t=this,e=t.options,i=e.aspectRatio,n=Q(e.autoCropArea)||.8,a=t.canvasData,o={width:a.width,height:a.height};i&&(a.height*i>a.width?o.height=o.width/i:o.width=o.height*i),t.cropBoxData=o,t.limitCropBox(!0,!0),o.width=Gt(Zt(o.width,o.minWidth),o.maxWidth),o.height=Gt(Zt(o.height,o.minHeight),o.maxHeight),o.width=Zt(o.minWidth,o.width*n),o.height=Zt(o.minHeight,o.height*n),o.oldLeft=o.left=a.left+(a.width-o.width)/2,o.oldTop=o.top=a.top+(a.height-o.height)/2,t.initialCropBoxData=h({},o)},limitCropBox:function(t,e){var i,n,a,o,r=this,s=r.options,l=s.aspectRatio,c=r.containerData,d=r.canvasData,p=r.cropBoxData,h=r.limited;t&&(i=Q(s.minCropBoxWidth)||0,n=Q(s.minCropBoxHeight)||0,i=Gt(i,c.width),n=Gt(n,c.height),a=Gt(c.width,h?d.width:c.width),o=Gt(c.height,h?d.height:c.height),l&&(i&&n?n*l>i?n=i/l:i=n*l:i?n=i/l:n&&(i=n*l),o*l>a?o=a/l:a=o*l),p.minWidth=Gt(i,a),p.minHeight=Gt(n,o),p.maxWidth=a,p.maxHeight=o),e&&(h?(p.minLeft=Zt(0,d.left),p.minTop=Zt(0,d.top),p.maxLeft=Gt(c.width,d.left+d.width)-p.width,p.maxTop=Gt(c.height,d.top+d.height)-p.height):(p.minLeft=0,p.minTop=0,p.maxLeft=c.width-p.width,p.maxTop=c.height-p.height))},renderCropBox:function(){var t=this,e=t.options,i=t.containerData,n=t.cropBoxData;(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=Gt(Zt(n.width,n.minWidth),n.maxWidth),n.height=Gt(Zt(n.height,n.minHeight),n.maxHeight),t.limitCropBox(!1,!0),n.oldLeft=n.left=Gt(Zt(n.left,n.minLeft),n.maxLeft),n.oldTop=n.top=Gt(Zt(n.top,n.minTop),n.maxTop),e.movable&&e.cropBoxMovable&&y(t.face,At,n.width===i.width&&n.height===i.height?qt:$t),f(t.cropBox,{width:n.width,height:n.height,left:n.left,top:n.top}),t.cropped&&t.limited&&t.limitCanvas(!0,!0),t.disabled||t.output()},output:function(){var t=this;t.preview(),t.complete&&C(t.element,Dt,t.getData())},initPreview:function(){var t,e=this,i=e.options.preview,n=S("img"),a=e.crossOrigin,o=a?e.crossOriginUrl:e.url;a&&(n.crossOrigin=a),n.src=o,X(e.viewBox,n),e.image2=n,i&&(e.previews=t=F.querySelectorAll(i),p(t,function(t){var e=S("img");y(t,Yt,{width:t.offsetWidth,height:t.offsetHeight,html:t.innerHTML}),a&&(e.crossOrigin=a),e.src=o,e.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',A(t),X(t,e)}))},resetPreview:function(){p(this.previews,function(t){var e=b(t,Yt);f(t,{width:e.width,height:e.height}),t.innerHTML=e.html,_(t,Yt)})},preview:function(){var t=this,e=t.imageData,i=t.canvasData,n=t.cropBoxData,a=n.width,o=n.height,r=e.width,s=e.height,l=n.left-i.left-e.left,c=n.top-i.top-e.top,d=H(e),u={WebkitTransform:d,msTransform:d,transform:d};t.cropped&&!t.disabled&&(f(t.image2,h({width:r,height:s,marginLeft:-l,marginTop:-c},u)),p(t.previews,function(t){var e=b(t,Yt),i=e.width,n=e.height,d=i,p=n,g=1;a&&(g=i/a,p=o*g),o&&p>n&&(g=n/o,d=a*g,p=n),f(t,{width:d,height:p}),f(L(t,"img")[0],h({width:r*g,height:s*g,marginLeft:-l*g,marginTop:-c*g},u))}))},bind:function(){var e=this,i=e.options,n=e.element,a=e.cropper;s(i.cropstart)&&x(n,yt,i.cropstart),s(i.cropmove)&&x(n,_t,i.cropmove),s(i.cropend)&&x(n,xt,i.cropend),s(i.crop)&&x(n,Dt,i.crop),s(i.zoom)&&x(n,Ct,i.zoom),x(a,dt,e._cropStart=u(e.cropStart,e)),i.zoomable&&i.zoomOnWheel&&x(a,ut,e._wheel=u(e.wheel,e)),i.toggleDragModeOnDblclick&&x(a,ft,e._dblclick=u(e.dblclick,e)),x(F,pt,e._cropMove=u(e.cropMove,e)),x(F,ht,e._cropEnd=u(e.cropEnd,e)),i.responsive&&x(t,gt,e._resize=u(e.resize,e))},unbind:function(){var e=this,i=e.options,n=e.element,a=e.cropper;s(i.cropstart)&&D(n,yt,i.cropstart),s(i.cropmove)&&D(n,_t,i.cropmove),s(i.cropend)&&D(n,xt,i.cropend),s(i.crop)&&D(n,Dt,i.crop),s(i.zoom)&&D(n,Ct,i.zoom),D(a,dt,e._cropStart),i.zoomable&&i.zoomOnWheel&&D(a,ut,e._wheel),i.toggleDragModeOnDblclick&&D(a,ft,e._dblclick),D(F,pt,e._cropMove),D(F,ht,e._cropEnd),i.responsive&&D(t,gt,e._resize)},resize:function(){var t,e,i,n=this,a=n.options.restore,o=n.container,r=n.containerData;!n.disabled&&r&&(i=o.offsetWidth/r.width,1===i&&o.offsetHeight===r.height||(a&&(t=n.getCanvasData(),e=n.getCropBoxData()),n.render(),a&&(n.setCanvasData(p(t,function(e,n){t[n]=e*i})),n.setCropBoxData(p(e,function(t,n){e[n]=t*i})))))},dblclick:function(){var t=this;t.disabled||t.setDragMode(g(t.dragBox,st)?qt:Pt)},wheel:function(t){var e=this,i=k(t),n=Q(e.options.wheelZoomRatio)||.1,a=1;e.disabled||(T(i),e.wheeling||(e.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),i.deltaY?a=i.deltaY>0?1:-1:i.wheelDelta?a=-i.wheelDelta/120:i.detail&&(a=i.detail>0?1:-1),e.zoom(-a*n,i)))},cropStart:function(t){var e,i,n,a=this,o=a.options,r=k(t),s=r.touches;if(!a.disabled){if(s){if(e=s.length,e>1){if(!o.zoomable||!o.zoomOnTouch||2!==e)return;i=s[1],a.startX2=i.pageX,a.startY2=i.pageY,n=Ft}i=s[0]}if(n=n||b(r.target,At),Tt.test(n)){if(C(a.element,yt,{originalEvent:r,action:n})===!1)return;T(r),a.action=n,a.cropping=!1,a.startX=i?i.pageX:r.pageX,a.startY=i?i.pageY:r.pageY,n===Pt&&(a.cropping=!0,m(a.dragBox,it))}}},cropMove:function(t){var e,i,n=this,a=n.options,o=k(t),r=o.touches,s=n.action;if(!n.disabled){if(r){if(e=r.length,e>1){if(!a.zoomable||!a.zoomOnTouch||2!==e)return;i=r[1],n.endX2=i.pageX,n.endY2=i.pageY}i=r[0]}if(s){if(C(n.element,_t,{originalEvent:o,action:s})===!1)return;T(o),n.endX=i?i.pageX:o.pageX,n.endY=i?i.pageY:o.pageY,n.change(o.shiftKey,s===Ft?o:null)}}},cropEnd:function(t){var e=this,i=e.options,n=k(t),a=e.action;e.disabled||a&&(T(n),e.cropping&&(e.cropping=!1,w(e.dragBox,it,e.cropped&&i.modal)),e.action="",C(e.element,xt,{originalEvent:n,action:a}))},change:function(t,e){var i,n,a=this,o=a.options,r=o.aspectRatio,s=a.action,l=a.containerData,c=a.canvasData,d=a.cropBoxData,p=d.width,h=d.height,u=d.left,f=d.top,g=u+p,m=f+h,w=0,b=0,y=l.width,_=l.height,x=!0;switch(!r&&t&&(r=p&&h?p/h:1),a.limited&&(w=d.minLeft,b=d.minTop,y=w+Gt(l.width,c.left+c.width),_=b+Gt(l.height,c.top+c.height)),n={x:a.endX-a.startX,y:a.endY-a.startY},r&&(n.X=n.y*r,n.Y=n.x/r),s){case $t:u+=n.x,f+=n.y;break;case Ot:if(n.x>=0&&(g>=y||r&&(f<=b||m>=_))){x=!1;break}p+=n.x,r&&(h=p/r,f-=n.Y/2),p<0&&(s=zt,p=0);break;case Ht:if(n.y<=0&&(f<=b||r&&(u<=w||g>=y))){x=!1;break}h-=n.y,f+=n.y,r&&(p=h*r,u+=n.X/2),h<0&&(s=Rt,h=0);break;case zt:if(n.x<=0&&(u<=w||r&&(f<=b||m>=_))){x=!1;break}p-=n.x,u+=n.x,r&&(h=p/r,f+=n.Y/2),p<0&&(s=Ot,p=0);break;case Rt:if(n.y>=0&&(m>=_||r&&(u<=w||g>=y))){x=!1;break}h+=n.y,r&&(p=h*r,u-=n.X/2),h<0&&(s=Ht,h=0);break;case It:if(r){if(n.y<=0&&(f<=b||g>=y)){x=!1;break}h-=n.y,f+=n.y,p=h*r}else n.x>=0?g<y?p+=n.x:n.y<=0&&f<=b&&(x=!1):p+=n.x,n.y<=0?f>b&&(h-=n.y,f+=n.y):(h-=n.y,f+=n.y);p<0&&h<0?(s=Wt,h=0,p=0):p<0?(s=Ut,p=0):h<0&&(s=Mt,h=0);break;case Ut:if(r){if(n.y<=0&&(f<=b||u<=w)){x=!1;break}h-=n.y,f+=n.y,p=h*r,u+=n.X}else n.x<=0?u>w?(p-=n.x,u+=n.x):n.y<=0&&f<=b&&(x=!1):(p-=n.x,u+=n.x),n.y<=0?f>b&&(h-=n.y,f+=n.y):(h-=n.y,f+=n.y);p<0&&h<0?(s=Mt,h=0,p=0):p<0?(s=It,p=0):h<0&&(s=Wt,h=0);break;case Wt:if(r){if(n.x<=0&&(u<=w||m>=_)){x=!1;break}p-=n.x,u+=n.x,h=p/r}else n.x<=0?u>w?(p-=n.x,u+=n.x):n.y>=0&&m>=_&&(x=!1):(p-=n.x,u+=n.x),n.y>=0?m<_&&(h+=n.y):h+=n.y;p<0&&h<0?(s=It,h=0,p=0):p<0?(s=Mt,p=0):h<0&&(s=Ut,h=0);break;case Mt:if(r){if(n.x>=0&&(g>=y||m>=_)){x=!1;break}p+=n.x,h=p/r}else n.x>=0?g<y?p+=n.x:n.y>=0&&m>=_&&(x=!1):p+=n.x,n.y>=0?m<_&&(h+=n.y):h+=n.y;p<0&&h<0?(s=Ut,h=0,p=0):p<0?(s=Wt,p=0):h<0&&(s=It,h=0);break;case qt:a.move(n.x,n.y),x=!1;break;case Ft:a.zoom(function(t,e,i,n){var a=ee(t*t+e*e),o=ee(i*i+n*n);return(o-a)/a}(Jt(a.startX-a.startX2),Jt(a.startY-a.startY2),Jt(a.endX-a.endX2),Jt(a.endY-a.endY2)),e),a.startX2=a.endX2,a.startY2=a.endY2,x=!1;break;case Pt:if(!n.x||!n.y){x=!1;break}i=B(a.cropper),u=a.startX-i.left,f=a.startY-i.top,p=d.minWidth,h=d.minHeight,n.x>0?s=n.y>0?Mt:It:n.x<0&&(u-=p,s=n.y>0?Wt:Ut),n.y<0&&(f-=h),a.cropped||(v(a.cropBox,at),a.cropped=!0,a.limited&&a.limitCropBox(!0,!0))}x&&(d.width=p,d.height=h,d.left=u,d.top=f,a.action=s,a.renderCropBox()),a.startX=a.endX,a.startY=a.endY},crop:function(){var t=this;return t.built&&!t.disabled&&(t.cropped||(t.cropped=!0,t.limitCropBox(!0,!0),t.options.modal&&m(t.dragBox,it),v(t.cropBox,at)),t.setCropBoxData(t.initialCropBoxData)),t},reset:function(){var t=this;return t.built&&!t.disabled&&(t.imageData=h({},t.initialImageData),t.canvasData=h({},t.initialCanvasData),t.cropBoxData=h({},t.initialCropBoxData),t.renderCanvas(),t.cropped&&t.renderCropBox()),t},clear:function(){var t=this;return t.cropped&&!t.disabled&&(h(t.cropBoxData,{left:0,top:0,width:0,height:0}),t.cropped=!1,t.renderCropBox(),t.limitCanvas(),t.renderCanvas(),v(t.dragBox,it),m(t.cropBox,at)),t},replace:function(t,e){var i=this;return!i.disabled&&t&&(i.isImg&&(i.element.src=t),e?(i.url=t,i.image.src=t,i.built&&(i.image2.src=t,p(i.previews,function(e){L(e,"img")[0].src=t}))):(i.isImg&&(i.replaced=!0),i.options.data=null,i.load(t))),i},enable:function(){var t=this;return t.built&&(t.disabled=!1,v(t.cropper,lt)),t},disable:function(){var t=this;return t.built&&(t.disabled=!0,m(t.cropper,lt)),t},destroy:function(){var t=this,e=t.element,i=t.image;return t.ready?(t.isImg&&t.replaced&&(e.src=t.originalUrl),t.unbuild(),v(e,at)):t.isImg?D(e,vt,t.start):i&&Y(i),_(e,et),t},move:function(t,e){var i=this,n=i.canvasData;return i.moveTo(a(t)?t:n.left+Q(t),a(e)?e:n.top+Q(e))},moveTo:function(t,e){var i=this,o=i.canvasData,r=!1;return a(e)&&(e=t),t=Q(t),e=Q(e),i.built&&!i.disabled&&i.options.movable&&(n(t)&&(o.left=t,r=!0),n(e)&&(o.top=e,r=!0),r&&i.renderCanvas(!0)),i},zoom:function(t,e){var i=this,n=i.canvasData;return t=Q(t),t=t<0?1/(1-t):1+t,i.zoomTo(n.width*t/n.naturalWidth,e)},zoomTo:function(t,e){var i,n,a,o,r=this,s=r.options,l=r.canvasData,c=l.width,d=l.height,p=l.naturalWidth,h=l.naturalHeight;if(t=Q(t),t>=0&&r.built&&!r.disabled&&s.zoomable){if(i=p*t,n=h*t,C(r.element,Ct,{originalEvent:e,oldRatio:c/p,ratio:i/p})===!1)return r;e?(a=B(r.cropper),o=e.touches?E(e.touches):{pageX:e.pageX,pageY:e.pageY},l.left-=(i-c)*((o.pageX-a.left-l.left)/c),l.top-=(n-d)*((o.pageY-a.top-l.top)/d)):(l.left-=(i-c)/2,l.top-=(n-d)/2),l.width=i,l.height=n,r.renderCanvas(!0)}return r},rotate:function(t){var e=this;return e.rotateTo((e.imageData.rotate||0)+Q(t))},rotateTo:function(t){var e=this;return t=Q(t),n(t)&&e.built&&!e.disabled&&e.options.rotatable&&(e.imageData.rotate=t%360,e.rotated=!0,e.renderCanvas(!0)),e},scale:function(t,e){var i=this,o=i.imageData,r=!1;return a(e)&&(e=t),t=Q(t),e=Q(e),i.built&&!i.disabled&&i.options.scalable&&(n(t)&&(o.scaleX=t,r=!0),n(e)&&(o.scaleY=e,r=!0),r&&i.renderImage(!0)),i},scaleX:function(t){var e=this,i=e.imageData.scaleY;return e.scale(t,n(i)?i:1)},scaleY:function(t){var e=this,i=e.imageData.scaleX;return e.scale(n(i)?i:1,t)},getData:function(t){var e,i,n=this,a=n.options,o=n.imageData,r=n.canvasData,s=n.cropBoxData;return n.built&&n.cropped?(i={x:s.left-r.left,y:s.top-r.top,width:s.width,height:s.height},e=o.width/o.naturalWidth,p(i,function(n,a){n/=e,i[a]=t?ie(n):n})):i={x:0,y:0,width:0,height:0},a.rotatable&&(i.rotate=o.rotate||0),a.scalable&&(i.scaleX=o.scaleX||1,i.scaleY=o.scaleY||1),i},setData:function(t){var e,i,a,o=this,l=o.options,c=o.imageData,d=o.canvasData,p={};return s(t)&&(t=t.call(o.element)),o.built&&!o.disabled&&r(t)&&(l.rotatable&&n(t.rotate)&&t.rotate!==c.rotate&&(c.rotate=t.rotate,o.rotated=e=!0),l.scalable&&(n(t.scaleX)&&t.scaleX!==c.scaleX&&(c.scaleX=t.scaleX,i=!0),n(t.scaleY)&&t.scaleY!==c.scaleY&&(c.scaleY=t.scaleY,i=!0)),e?o.renderCanvas():i&&o.renderImage(),a=c.width/c.naturalWidth,n(t.x)&&(p.left=t.x*a+d.left),n(t.y)&&(p.top=t.y*a+d.top),n(t.width)&&(p.width=t.width*a),n(t.height)&&(p.height=t.height*a),o.setCropBoxData(p)),o},getContainerData:function(){var t=this;return t.built?t.containerData:{}},getImageData:function(){var t=this;return t.ready?t.imageData:{}},getCanvasData:function(){var t=this,e=t.canvasData,i={};return t.built&&p(["left","top","width","height","naturalWidth","naturalHeight"],function(t){i[t]=e[t]}),i},setCanvasData:function(t){var e=this,i=e.canvasData,a=i.aspectRatio;return s(t)&&(t=t.call(e.element)),e.built&&!e.disabled&&r(t)&&(n(t.left)&&(i.left=t.left),n(t.top)&&(i.top=t.top),n(t.width)?(i.width=t.width,i.height=t.width/a):n(t.height)&&(i.height=t.height,i.width=t.height*a),e.renderCanvas(!0)),e},getCropBoxData:function(){var t,e=this,i=e.cropBoxData;return e.built&&e.cropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(t){var e,i,a=this,o=a.cropBoxData,l=a.options.aspectRatio;return s(t)&&(t=t.call(a.element)),a.built&&a.cropped&&!a.disabled&&r(t)&&(n(t.left)&&(o.left=t.left),n(t.top)&&(o.top=t.top),n(t.width)&&(e=!0,o.width=t.width),n(t.height)&&(i=!0,o.height=t.height),l&&(e?o.height=o.width/l:i&&(o.width=o.height*l)),a.renderCropBox()),a},getCroppedCanvas:function(t){var e,i,n,a,o,s,l,c,d,p,h,u=this;if(u.built&&u.cropped&&Vt)return r(t)||(t={}),h=u.getData(),e=h.width,i=h.height,c=e/i,r(t)&&(o=t.width,s=t.height,o?(s=o/c,l=o/e):s&&(o=s*c,l=s/i)),n=ne(o||e),a=ne(s||i),d=S("canvas"),d.width=n,d.height=a,p=d.getContext("2d"),t.fillColor&&(p.fillStyle=t.fillColor,p.fillRect(0,0,n,a)),p.drawImage.apply(p,function(){var t,n,a,o,r,s,c=W(u.image,u.imageData),d=c.width,p=c.height,f=u.canvasData,g=[c],m=h.x+f.naturalWidth*(Jt(h.scaleX||1)-1)/2,v=h.y+f.naturalHeight*(Jt(h.scaleY||1)-1)/2;return m<=-e||m>d?m=t=a=r=0:m<=0?(a=-m,m=0,t=r=Gt(d,e+m)):m<=d&&(a=0,t=r=Gt(e,d-m)),t<=0||v<=-i||v>p?v=n=o=s=0:v<=0?(o=-v,v=0,n=s=Gt(p,i+v)):v<=p&&(o=0,n=s=Gt(i,p-v)),g.push(ne(m),ne(v),ne(t),ne(n)),l&&(a*=l,o*=l,r*=l,s*=l),r>0&&s>0&&g.push(ne(a),ne(o),ne(r),ne(s)),g}.call(u)),d},setAspectRatio:function(t){var e=this,i=e.options;return e.disabled||a(t)||(i.aspectRatio=Zt(0,t)||NaN,e.built&&(e.initCropBox(),e.cropped&&e.renderCropBox())),e},setDragMode:function(t){var e,i,n=this,a=n.options,o=n.dragBox,r=n.face;return n.ready&&!n.disabled&&(e=t===Pt,i=a.movable&&t===qt,t=e||i?t:jt,y(o,At,t),w(o,st,e),w(o,rt,i),a.cropBoxMovable||(y(r,At,t),w(r,st,e),w(r,rt,i))),n}},q.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},q.TEMPLATE=function(t,e){return e=e.split(","),t.replace(/\d+/g,function(t){return e[t]})}('<0 6="5-container"><0 6="5-wrap-9"><0 6="5-canvas"></0></0><0 6="5-drag-9"></0><0 6="5-crop-9"><1 6="5-view-9"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-center"></1><1 6="5-face"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,action,data,point,cropper,class,line,dashed,box");var de=t.Cropper;return q.noConflict=function(){return t.Cropper=de,q},q.setDefaults=function(t){h(q.DEFAULTS,t)},"function"==typeof define&&define.amd&&define("cropper",[],function(){return q}),e||(t.Cropper=q),q}),function(){var t=this;!function(){var e,i,n,a,o,r=this,s=!1,l="http://qiniu.cdn-chuang.com/",c="",d={aspectRatio:1,croppedable:!0,finish:function(){},error:function(){}};t.imageCrop=function(t,n){return!!t.length&&(e=t[0],c=e.name,r.domInit(),r.setOpts(n),void r.getImageData(t[0],function(t){r.imageLoad(t,function(){i.src=t,r.cropperInit()})}))},this.domInit=function(){var t=$("#uploadContainer");t.length?t.addClass("active"):($("body").append(r.template()),i=document.getElementById("croppedImage"),a=$("#uploadContainer"),o=$("#uploadConfirm").click(r.confirm),$("#uploadCancel").click(r.cancel))},this.imageLoad=function(t,e){var i=new Image;i.src=t,i.onload=e},this.template=function(){return'<div id="uploadContainer" class="upload-container active"> <div class="image-container"> <div class="preview"> <img id="croppedImage"> </div> <div class="footer"> <a id="uploadConfirm" class="confirm pub-background-transition"><span>确定</span><em></em></a> <a id="uploadCancel" class="cancel pub-background-transition"><span>取消</span></a> </div> </div> </div>'},this.setOpts=function(t){d=$.extend(d,t)},this.cancel=function(){return i.src="",a.removeClass("active")},this.getImageData=function(t,e){var i;if($.isFunction(e))return window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(t.type)?(i=new FileReader,i.onload=function(t){return e(t.target.result)},i.readAsDataURL(t),n=t.type,s=/gif/.test(t.type)):e("")},this.cropper=null,this.cropperInit=function(){return r.cropper&&r.cropper.destroy(),d.croppedable&&!s&&(r.cropper=new Cropper(i,{built:function(){var t=this.cropper,e=t.getContainerData();t.setCropBoxData({left:e.width/4,width:e.width/2})},viewMode:"1",zoomable:!1,movable:!1,rotatable:!1,scalable:!1,aspectRatio:d.aspectRatio,cropBoxResizable:!0}))},this.confirm=function(){o.addClass("loading"),!d.croppedable||s?r.uploadNormal():r.uploadBase64(r.croppedImage())},this.croppedImage=function(){return r.cropper.getCroppedCanvas().toDataURL(n)},this.put64=function(t,e){var i=t,n="http://up.qiniu.com/putb64/-1",a=new XMLHttpRequest;a.onreadystatechange=function(){var t={};if(4==a.readyState){try{t=JSON.parse(a.responseText)}catch(e){d.error("上传失败")}t.key&&r.finish(l+t.key),o.removeClass("loading")}},n=n+"/key/"+r.serverFilename(),a.open("POST",n,!0),a.setRequestHeader("Content-Type","application/octet-stream"),a.setRequestHeader("Authorization","UpToken "+e),a.send(i)},this.uploadNormal=function(){imageUploader(function(){},function(){},function(t,e){r.finish(l+e),o.removeClass("loading")},function(t){d.error(t),o.removeClass("loading")}).maxSize(5).upload(e)},this.serverFilename=function(){var t=c.split("."),e=t.length,i=t[e-1];(new Date).getTime();return r.strBase64(r.strBase64(c).substr(0,16)+"."+i)},this.strBase64=function(t){if(window.hasOwnProperty("btoa"))return btoa(t);t=escape(t);var e,i,n,a,o,r="",s="",l="",c=0,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";do e=t.charCodeAt(c++),i=t.charCodeAt(c++),s=t.charCodeAt(c++),n=e>>2,a=(3&e)<<4|i>>4,o=(15&i)<<2|s>>6,l=63&s,isNaN(i)?o=l=64:isNaN(s)&&(l=64),r=r+d.charAt(n)+d.charAt(a)+d.charAt(o)+d.charAt(l),e=i=s="",n=a=o=l="";while(c<t.length);return r},this.uploadBase64=function(t){var e=t.split(","),i=e[1];request.get("/qiniu/upload/token",function(t){t.token&&r.put64(i,t.token)})},this.finish=function(t){r.imageLoad(t,function(){r.cancel(),d.finish(t),a.removeClass("active")})}}()}.call(this),function(){Sortable.create(document.getElementById("special-article-container"),{animation:300,draggable:".special-article",handle:".special-article",ghostClass:"drag-ghost",onUpdate:function(){var t,e=$(".special-article"),i=[];e.each(function(){t=$(this).data("id"),!!t&&i.push(t)}),controller_pop.selected=i}})}.call(define("plugin_sortable")),function(){var t=this;this.model={el:"#admin-content",data:{background:!1,search:{keyword:""},orderby:data.orderby,order:"desc",pagination:{total:data.total,size:10,index:1,btns:[],all:0},list:data.list},methods:{_search:function(){t.page_search()},_size:function(e){t.page_size(e)},_turn:function(e){"number"==typeof e&&t.page_turn(e)},_next:function(){this.pagination.index+1<=this.pagination.all&&t.page_turn(this.pagination.index+1)},_prev:function(){this.pagination.index-1>=1&&t.page_turn(this.pagination.index-1)},_order:function(e){this.orderby=e,this.order="desc"==this.order?"asc":"desc",t.page_order()},_edit:function(t){controller_pop.display.edit.show(t)},_post:function(t,e){controller_pop.display.post.show(t,e)},_preview:function(t){controller_pop.display.preview.show(t)},_add:function(){controller_pop.display.add.show()},_del:function(e){pop.confirm("确认删除 ?","确定",function(){t.delete_user(e)})}}},this.page_search=function(){t.get_data()},this.page_order=function(){t.get_data()},this.page_turn=function(e){t.model.data.pagination.index=e,t.get_data()},this.page_size=function(e){var i=t.model.data.pagination;i.size=e,i.all=Math.ceil(i.total/i.size),i.index>i.all&&(i.index=i.all),t.get_data()},this.update_pagination_btn=function(){var e=t.model.data.pagination;return e.all=Math.ceil(e.total/e.size),e.btns=t.create_pagination_btn(e.index,e.size,e.total)},this.create_pagination_btn=function(t,e,i){var n,a,o=Math.ceil(i/e),r=[],s=function(t,e){return r.push({active:t,index:e})},l=function(){return r.push({active:!1,index:"..."})};if(o<=7)for(var c=1;c<=o;c++)s(c==t,c);else{n=t-3<1?1:t-3,a=t+3>o?o:t+3,n>1&&s(!1,1),n>2&&l();for(var c=n;c<=a;c++)s(c==t,c);a<o-1&&l(),a<o&&s(!1,o)}return r},this.get_data=function(){var e=t.model.data;request.get("/admin/special/list",function(e){e.hasOwnProperty("code")&&0==e.code&&(t.model.data.pagination.total=e.data.total,t.model.data.list=e.data.list,t.update_pagination_btn())},{index:e.pagination.index,size:e.pagination.size,order:e.order,orderby:e.orderby,keyword:e.search.keyword})},this.delete_user=function(e){request.get("/admin/special/delete",function(e){e.hasOwnProperty("code")&&0==e.code?t.get_data():pop.error("操作失败","确定")},{id:e})},this.vue=new Vue(t.model),t.update_pagination_btn()}.call(define("controller_admin")),function(){var t=this;this.selected=[],this.vue=new Vue({el:"#pop-container",data:{display:"",unfold:!1,special:{id:"",title:"",summary:"",cover:{val:"",progress:{active:!1,percent:"0 %"}},bk:{val:"",progress:{active:!1,percent:"0 %"}},list:[],post:""},preview:{title:"",summary:"",image:"",bg_image:"",list:[]},search:{keyword:"",list:[]}},methods:{_close:function(){t.display.hide()},_fold:function(){this.unfold=!this.unfold,this.unfold&&t.get_article_list()},_del_cover_image:function(){this.special.cover.val=""},_del_bk_image:function(){this.special.bk.val=""},_upload_cover_image:function(){var e=this.$els.cover,i=t.vue.special.cover;return e.files?(imageCrop(e.files,{aspectRatio:16/9,croppedable:!0,finish:function(t){i.val=t},error:function(t){pop.error(t||"上传失败","确定").one()}}),void(e.value="")):pop.error("浏览器兼容性错误","确定").one()},_upload_bk_image:function(){var e=this.$els.bk,i=t.vue.special.bk;return e.files?(imageCrop(e.files,{aspectRatio:16/9,croppedable:!1,finish:function(t){i.val=t+"?imageMogr2/thumbnail/900000@"},error:function(t){pop.error(t||"上传失败","确定").one()}}),void(e.value="")):pop.error("浏览器兼容性错误","确定").one()},_confirm_special:function(){""==t.vue.special.id?t.add():t.save()},_confirm_post:function(){t.post()},_remove_article:function(e){t.select_cancel(e)},_search:function(){t.get_article_list()},_select:function(e,i){t.select_article(e),this.search.list.splice(i,1)},_post_type:function(t){this.special.post=t}}}),this.display={preview:{show:function(e){controller_admin.model.data.background=!0,t.vue.display="special-preview",t.special_preview(e)}},add:{show:function(){controller_admin.model.data.background=!0,t.vue.display="add"}},edit:{show:function(e){controller_admin.model.data.background=!0,t.vue.display="edit",t.vue.special.id=e,t.get_special_info()}},post:{show:function(e,i){controller_admin.model.data.background=!0,t.vue.display="post",t.vue.special.id=e,t.vue.special.post=i}},hide:function(){controller_admin.model.data.background=!1,t.vue.display="",t.vue.special.id="",t.vue.preview={title:"",summray:"",image:"",bg_image:"",list:[]},t.empty()}},this.special_preview=function(e){request.get("/admin/special/info",function(e){e.hasOwnProperty("code")&&0==e.code&&(t.vue.preview=e.data)},{id:e})},this.fill=function(e){if(!!e.bg_image&&(t.vue.special.bk.val=e.bg_image),!!e.image&&(t.vue.special.cover.val=e.image),!!e.title&&(t.vue.special.title=e.title),!!e.summary&&(t.vue.special.summary=e.summary),!!e.id&&(t.vue.special.id=e.id),e.list){t.vue.special.list=e.list;for(var i in e.list)t.selected.push(e.list[i].id)}},this.form=function(){return{title:t.vue.special.title,summary:t.vue.special.summary,id:t.vue.special.id,image:t.vue.special.cover.val,bg_image:t.vue.special.bk.val,list:t.selected}},this.check=function(){var e=t.form();return w=""==e.title&&"标题"||""==e.summary&&"描述"||""==e.image&&"封面图片"||!e.bg_image&&"背景图片"||0==e.list.length&&"文章列表"||!1,!w||(pop.error(w+"为空","确定").one(),!1)},this.empty=function(){t.selected=[],t.vue.unfold=!1,t.vue.special.id="",t.vue.special.title="",t.vue.special.summary="",t.vue.special.list=[],t.vue.special.cover.val="",t.vue.special.bk.val="",t.vue.search.list=[],t.vue.search.keyword="",t.vue.special.post=""},this.select_cancel=function(e){var i=t.vue.special.list,n=[],a={};for(var o in i)i[o].id!=e?n.push(i[o]):a=i[o];t.selected.splice($.inArray(e,t.selected),1),t.vue.special.list=n,t.vue.search.list.push(a)},this.select_article=function(e){var i=t.get_article_info(e);i.id&&$.inArray(i.id,t.selected)==-1&&(t.vue.special.list.push(i),t.selected.push(i.id))},this.search_filter=function(e){var i=[];for(var n in e)$.inArray(e[n].id,t.selected)==-1&&i.push(e[n]);t.vue.search.list=i},this.save=function(){return!!t.check()&&void request.get("/admin/special/save",function(e){e.hasOwnProperty("code")&&0==e.code&&(t.display.hide(),t.update_list())},t.form())},this.add=function(){return!!t.check()&&void request.get("/admin/special/add",function(e){e.hasOwnProperty("code")&&0==e.code&&(t.display.hide(),t.update_list())},t.form())},this.get_article_info=function(e){var i=t.vue.search.list,n={};for(var a in i)i[a].id&&i[a].id==e&&(n=i[a]);return n},this.get_article_list=function(){request.get("/admin/special/articles",function(e){e.hasOwnProperty("code")&&0==e.code&&t.search_filter(e.data)},{keyword:t.vue.search.keyword})},this.get_special_info=function(){request.get("/admin/special/info",function(e){e.hasOwnProperty("code")&&0==e.code&&t.fill(e.data)},{id:t.vue.special.id})},this.post=function(){request.get("/admin/special/post",function(e){e.hasOwnProperty("code")&&0==e.code&&(t.display.hide(),t.update_list())},{id:t.vue.special.id,post:"now"==t.vue.special.post?1:0})},this.update_list=function(){controller_admin.get_data()}}.call(define("controller_pop"));