!function(e,t){if(!e.initGeetest){var r=t.getElementsByTagName("head")[0],n=location.protocol+"//",o=[],a="init",i=function(){return parseInt(1e4*Math.random())+(new Date).valueOf()},c=function(){for(var e=0,t=o.length;e<t;e+=1)o[e]();o=[]},s=function(){return e.Geetest||t.getElementById("gt_lib")},u=function(e){var o=t.createElement("script");o.charset="UTF-8",o.type="text/javascript",o.onload=o.onreadystatechange=function(){if(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState){if(s())a="loaded",c();else{if(a="fail","function"!=typeof e.onError)throw new Error("网络错误");e.onError()}o.onload=o.onreadystatechange=null}},o.onerror=function(){if(a="fail",o.onerror=null,"function"!=typeof e.onError)throw new Error("网络错误");e.onError()};var i=e.staticservers&&e.staticservers[0]||"static.geetest.com/";o.src=n+i+"static/js/geetest.0.0.0.js",r.appendChild(o)},d=function(o){a="loading";var d="geetest_"+i();e[d]=function(){a="loaded",c(),e[d]=void 0;try{delete e[d]}catch(t){}};var p=t.createElement("script");p.charset="UTF-8",p.type="text/javascript",p.onload=p.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||s()||u(o)},p.onerror=function(){u(o)};var l=o.apiserver||"api.geetest.com/";p.src=n+l+"getfrontlib.php?gt="+o.gt+"&callback="+d,r.appendChild(p)};s()&&(a="loaded"),e.initGeetest=function(t,r){if("string"!=typeof t.gt)throw new Error("");var n=function(){r(new e.Geetest(t))};if("loaded"===a)n();else if("fail"===a){if("function"!=typeof t.onError)throw new Error("网络错误");t.onError()}else"loading"===a?o.push(function(){n()}):"init"===a&&(o.push(function(){n()}),d(t))}}}(window,document),function(){var e,t=this,r=!1;this.start=function(t){e=t,jQuery("#gt-btn").click()},this.load=function(){return!r&&(jQuery(document.body).append('<div id="geetest" class="geetest"></div><div id="gt-btn"></div>'),void request.get("/geetest/start",function(t){initGeetest({gt:t.gt,challenge:t.challenge,product:"popup",offline:!t.success},function(t){jQuery("#gt-btn").click(function(){var r=t.getValidate();return r?void request.post("/geetest/verify",function(t){t.hasOwnProperty("code")&&"0"==t.code&&e()},{geetest_challenge:r.geetest_challenge,geetest_validate:r.geetest_validate,geetest_seccode:r.geetest_seccode}):void pop.error("请完成图片验证","确定").one()}),t.bindOn("#gt-btn"),t.appendTo("#geetest"),r=!0})}))},this.timer=setTimeout(t.load,2e3)}.call(define("libGeetest")),function(){var e=this;this.vue=new Vue({el:"#regist-form",data:{username:{val:"",error:!1,error_tip:""},phone:{val:"",error:!1,error_tip:""},captcha:{val:"",error:!1,error_tip:"",text:"发送验证码",disable:0},password:{val:"",error:!1,error_tip:""},password_re:{val:"",error:!1,error_tip:""}},methods:{_check_username:function(){e.verify_username()},_check_phone:function(){e.verify_phone()},_get_captcha:function(){e.vue.captcha.disable||e.verify_phone(function(){libGeetest.start(function(){e.captcha_send()})})},_submit:function(){e.verify_all(function(){e.regist()})}}}),this.verify_phone=function(t){var r=e.vue.phone;return""==r.val?e.error(r,"手机号码为空"):constant.regex().phone.test(r.val)?request.post("/account/exist",function(n){n.hasOwnProperty("code")&&"0"==n.code?e.error(r,"手机号码已存在"):"function"==typeof t&&t()},{username:r.val}):e.error(r,"格式错误")},this.verify_username=function(t){var r=e.vue.username;return""==r.val?e.error(r,"用户名为空"):/^\d+$/.test(r.val)?e.error(r,"用户名不能为纯数字"):/^[a-zA-Z0-9_]+$/.test(r.val)?request.post("/account/exist",function(n){n.hasOwnProperty("code")&&"0"==n.code?e.error(r,"用户已存在"):"function"==typeof t&&t()},{username:r.val}):e.error(r,"只能为英文、数字组合")},this.verify_all=function(t){var r=e.vue;return""==r.username.val?e.error(r.username,"用户名为空"):""==r.phone.val?e.error(r.phone,"手机号码为空"):""==r.captcha.val?e.error(r.captcha,"验证码为空"):6!=r.captcha.val.length?e.error(r.captcha,"验证码输入有误"):r.password.val.length<6?e.error(r.password,"密码需大于6位"):r.password.val!=r.password_re.val?e.error(r.password_re,"两次输入密码不一致"):"function"==typeof t?t():void 0},this.regist=function(){var t=e.vue,r={username:t.username.val,phone:t.phone.val,captcha:t.captcha.val,password:t.password.val};return request.post("/account/regist",function(r){if(r.hasOwnProperty("code")){if("0"==r.code)return e.redirect(r.data.session,r.data.site);if("20001"==r.code)return e.error(t.username,r.msg);if("20002"==r.code)return e.error(t.phone,r.msg);if("20003"==r.code)return e.error(t.captcha,r.msg);if("20004"==r.code)return e.error(t.password,r.msg)}},r)},this.redirect=function(e,t){var r=/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/,n=input.get("redirect"),o=n?decodeURIComponent(n):"/",a=r.exec(o);return t&&a&&a[0]?location.href="http://"+a[0]+"/sso/"+input.create_param({session:e,redirect:o}):location.href=o},this.captcha_send=function(){var t=e.vue.phone;return request.post("/account/captcha",function(r){r.hasOwnProperty("code")&&"0"==r.code?e.captcha_count((new Date).getTime()):e.error(t,r.msg||"发送失败,请重试")},{phone:t.val})},this.captcha_count=function(t){var r,n;return e.vue.captcha.disable=!0,n=setInterval(function(){r=60-((new Date).getTime()-t)/1e3,r>=0?e.vue.captcha.text=Math.floor(r)+" 秒后重发":(clearInterval(n),e.vue.captcha.disable=!1,e.vue.captcha.text="重新发送")},500)},this.regist_success=function(){return input.get("redirect")?location.href=decodeURIComponent(input.get("redirect")):pop.success("注册成功","返回登录",function(){location.href="/account/login"})},this.error=function(e,t){e.error_tip=t,e.error=1,setTimeout(function(){e.error=0},2e3)}}.call(define("c_regist"));