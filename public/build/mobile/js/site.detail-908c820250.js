(function(){var e,t=this,i=jQuery("#site-head-menu"),n=i.children("ul"),o=jQuery("#site-head-nav"),a=o.children(".nav-container"),r=jQuery("#site-qr"),c=jQuery("#weixin");this.container=function(t){t?(e&&clearTimeout(e),e=setTimeout(function(){a.addClass("active")},400)):a.removeClass("active")},c.click(function(){var e=jQuery(this).data("src");r.hasClass("active")?r.removeClass("active"):(e&&(r.children("img").attr("src",e),jQuery(this).data("src",null)),r.addClass("active"))}),i.click(function(){o.hasClass("active")?(o.addClass("negactive").removeClass("active"),n.removeClass("active"),t.container(0)):(o.addClass("active").removeClass("negactive"),n.addClass("active"),t.container(1))})}).call(define("c_menu")),function(){var e=this;this.vue=new Vue({el:"#list-container",data:{list:[]},methods:{}}),this.render=function(t){for(var i=t.length,n=[],o=0;o<i;o++)n[o]={id:t[o].id,type:t[o].type,title:t[o].title,date:t[o].date,url:t[o].url,image:t[o].imgs&&t[o].imgs.length>0?t[o].imgs[0]:""};e.vue.list=n}}.call(define("controller")),function(){var e=this,t=location.pathname.match(/\d{3,10}/)[0],i=global.platform.home+"/account/login?redirect="+encodeURIComponent(location.href);this.vue=new Vue({el:"#social-bar",data:{like:data.like,favorite:data.favorite,likes:data.likes,favorites:data.favorites},methods:{_like:function(){e.like()},_favorite:function(){e.fav()},_input:function(){c_textarea.vue.display=!0,c_textarea.vue.id=0,c_textarea.vue.call=function(){}}}}),this.like=function(){request.get("/social/like",function(t){t.hasOwnProperty("code")&&(0==t.code?(e.vue.like="LIKE"==t.data.valid,e.vue.likes=t.data.count):40003==t.code&&e.login())},{id:t})},this.fav=function(){request.get("/social/favorite",function(t){t.hasOwnProperty("code")&&(0==t.code?(e.vue.favorite="FAV"==t.data.valid,e.vue.favorites=t.data.count):40003==t.code&&e.login())},{id:t})},this.login=function(){pop.confirm("操作首先需登录","前往登录",function(){location.href=i},"返回")},this.direct_login=function(){return location.href=i}}.call(define("c_social")),function(){var e=this;this.vue=new Vue({el:"#comment-textarea",data:{display:!1,input:"",placeholder:"请输入评论内容",login:""!=global.user.id,id:0,top:0,call:function(){}},methods:{_cancel:function(){this.display=!1,this.input="",this.placeholder="请输入评论内容",this.id=0},_submit:function(){c_comment.comment_submit(this.id,this.input,function(){e.vue._cancel(),c_comment.update_comment(),e.vue.call()})},_login:function(){c_social.direct_login()},_blur:function(){var e;setTimeout(function(){e=this.top>150?this.top-150:jQuery("#comment-list").offset().top,!!e&&jQuery(window).scrollTop(e)},500)}}})}.call(define("c_textarea")),function(){var e=this,t={id:data.site.id,name:data.site.name},i={id:global.user.id,avatar:global.user.avatar||"http://dn-noman.qbox.me/question%20mark.png",name:global.user.name,role:global.user.role},n=global.platform.home+"/account/login?redirect="+encodeURIComponent(location.href),o=!1;return"1"==data.comment&&(this.save=[],this.vue=new Vue({el:"#comment-list",data:{site:t,user:i,orderby:"hot",reply:!1,input:"",list:[],all:!1},methods:{_login:function(){location.href=n},_like:function(t,i,n,o){e.comment_like(t,n,function(){"undefined"==typeof o?e.vue.list[i].like=n:e.vue.list[i].replies[o].like=n})},_all:function(){this.all=!0},_comment_fold:function(t,i){var n=this.list[t],o=[];return this.list[t].reply_fold=0,e.vue.list[t].comment_fold&&!i?e.vue.list[t].comment_fold=0:void request.get("/comment/comments",function(i){i.hasOwnProperty("code")&&"0"==i.code&&(o=i.data,o.length>0&&(e.vue.list[t].replies=o,e.vue.list[t].comment_fold=1))},{id:data.article.source,root:n.id,order:"asc",orderby:"new"})},_comment:function(){c_textarea.vue.display=!0,c_textarea.vue.id=0,c_textarea.vue.call=function(){}},_reply:function(t,i,n,o){var a=jQuery(t.target).offset().top;c_textarea.vue.display||(c_textarea.vue.placeholder="@"+i,c_textarea.vue.top=a,c_textarea.vue.call=function(){e.vue._comment_fold(n,1)},"undefined"!=typeof o?c_textarea.vue.id=this.list[n].replies[o].id:c_textarea.vue.id=this.list[n].id,c_textarea.vue.display=!0)},_orderby:function(t){this.orderby=t,e.update_comment()}}}),this.update_comment=function(){request.get("/comment/comments",function(t){t.hasOwnProperty("code")&&"0"==t.code&&(e.vue.list=e.save=t.data)},{id:data.article.source,orderby:e.vue.orderby})},this.comment_like=function(e,t,o){return""==i.id?pop.confirm("操作首先需登录","前往登录",function(){location.href=n},"取消"):void request.get("/comment/like",function(e){e.hasOwnProperty("code")&&"0"==e.code&&o()},{id:e,valid:t?1:0})},this.comment_submit=function(e,t,a){var r;return!o&&(""==i.id?pop.confirm("操作首先需登录","前往登录",function(){location.href=n},"取消"):t.length<5?pop.error("评论过短","确定").one():(o=!0,r=function(){request.get("/comment/submit",function(e){return o=!1,e.hasOwnProperty("code")?void("0"==e.code?a():"40003"==e.code?libGeetest.start(r):pop.error(e.msg||"评论失败,请重试","确定").one()):pop.error("评论失败,请重试","确定").one()},{id:data.article.source,content:t,parent:e})},void r()))},void(this.timer=setInterval(function(){var t,i=document.getElementById("comment-list");return!(i.getBoundingClientRect&&(t=i.getBoundingClientRect(),t.top-300>(window.innerHeight||document.documentElement.clientHeight)))&&(e.update_comment(),void clearInterval(e.timer))},300)))}.call(define("c_comment")),function(e,t){if(!e.initGeetest){var i=t.getElementsByTagName("head")[0],n=location.protocol+"//",o=[],a="init",r=function(){return parseInt(1e4*Math.random())+(new Date).valueOf()},c=function(){for(var e=0,t=o.length;e<t;e+=1)o[e]();o=[]},l=function(){return e.Geetest||t.getElementById("gt_lib")},s=function(e){var o=t.createElement("script");o.charset="UTF-8",o.type="text/javascript",o.onload=o.onreadystatechange=function(){if(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState){if(l())a="loaded",c();else{if(a="fail","function"!=typeof e.onError)throw new Error("网络错误");e.onError()}o.onload=o.onreadystatechange=null}},o.onerror=function(){if(a="fail",o.onerror=null,"function"!=typeof e.onError)throw new Error("网络错误");e.onError()};var r=e.staticservers&&e.staticservers[0]||"static.geetest.com/";o.src=n+r+"static/js/geetest.0.0.0.js",i.appendChild(o)},d=function(o){a="loading";var d="geetest_"+r();e[d]=function(){a="loaded",c(),e[d]=void 0;try{delete e[d]}catch(t){}};var u=t.createElement("script");u.charset="UTF-8",u.type="text/javascript",u.onload=u.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||l()||s(o)},u.onerror=function(){s(o)};var f=o.apiserver||"api.geetest.com/";u.src=n+f+"getfrontlib.php?gt="+o.gt+"&callback="+d,i.appendChild(u)};l()&&(a="loaded"),e.initGeetest=function(t,i){if("string"!=typeof t.gt)throw new Error("");var n=function(){i(new e.Geetest(t))};if("loaded"===a)n();else if("fail"===a){if("function"!=typeof t.onError)throw new Error("网络错误");t.onError()}else"loading"===a?o.push(function(){n()}):"init"===a&&(o.push(function(){n()}),d(t))}}}(window,document),function(){var e,t=this,i=!1;this.start=function(t){e=t,jQuery("#gt-btn").click()},this.load=function(){return!i&&(jQuery(document.body).append('<div id="geetest" class="geetest"></div><div id="gt-btn"></div>'),void request.get("/geetest/start",function(t){initGeetest({gt:t.gt,challenge:t.challenge,product:"popup",offline:!t.success},function(t){jQuery("#gt-btn").click(function(){var i=t.getValidate();return i?void request.post("/geetest/verify",function(t){t.hasOwnProperty("code")&&"0"==t.code&&e()},{geetest_challenge:i.geetest_challenge,geetest_validate:i.geetest_validate,geetest_seccode:i.geetest_seccode}):void pop.error("请完成图片验证","确定").one()}),t.bindOn("#gt-btn"),t.appendTo("#geetest"),i=!0})}))},this.timer=setTimeout(t.load,2e3)}.call(define("libGeetest"));